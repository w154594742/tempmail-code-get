<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>临时邮箱工具</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header class="header">
            <div class="header-left">
                <span class="icon">📧</span>
                <h1 class="title">临时邮箱工具</h1>
            </div>
            <div class="header-right">
                <button id="settingsBtn" class="icon-btn" title="设置">⚙️</button>
            </div>
        </header>

        <!-- 邮箱生成区域 -->
        <section class="email-section">
            <div class="section-header">
                <span class="section-icon">📧</span>
                <h2 class="section-title">当前邮箱</h2>
            </div>
            <div class="input-group">
                <input type="text" id="emailInput" class="email-input" placeholder="点击生成邮箱..." readonly>
                <button id="copyEmailBtn" class="copy-btn" title="复制邮箱">📋</button>
            </div>
            <div class="button-group">
                <button id="generateEmailBtn" class="primary-btn">生成新邮箱</button>
                <button id="emailHistoryBtn" class="secondary-btn">历史邮箱</button>
            </div>
        </section>

        <!-- 验证码获取区域 -->
        <section class="code-section">
            <div class="section-header">
                <span class="section-icon">🔐</span>
                <h2 class="section-title">当前验证码</h2>
            </div>
            <div class="input-group">
                <input type="text" id="codeInput" class="code-input" placeholder="点击获取验证码..." readonly>
                <button id="copyCodeBtn" class="copy-btn" title="复制验证码">📋</button>
            </div>
            <div class="button-group">
                <button id="getCodeBtn" class="primary-btn">获取验证码</button>
                <button id="stopCodeBtn" class="danger-btn" style="display: none;">停止获取</button>
                <button id="codeHistoryBtn" class="secondary-btn">历史验证码</button>
            </div>
        </section>

        <!-- 状态信息区域 -->
        <section class="status-section">
            <div class="section-header">
                <span class="section-icon">📊</span>
                <h2 class="section-title">状态信息</h2>
            </div>
            <div id="statusContainer" class="status-container">
                <div class="status-item">
                    <span class="status-dot ready"></span>
                    <span class="status-text">就绪</span>
                </div>
            </div>
        </section>

        <!-- 自动化注册区域 -->
        <section class="automation-section">
            <div class="section-header">
                <span class="section-icon">🤖</span>
                <h2 class="section-title">自动化注册</h2>
            </div>

            <!-- 流程选择 -->
            <div class="flow-selection">
                <select id="flowSelector" class="flow-select">
                    <option value="">选择自动化流程...</option>
                    <!-- 动态加载流程配置 -->
                </select>
                <button id="refreshFlowsBtn" class="icon-btn" title="刷新流程列表">🔄</button>
            </div>

            <!-- 执行状态显示 -->
            <div class="automation-status" id="automationStatus" style="display: none;">
                <div class="status-header">
                    <span class="status-icon" id="statusIcon">⏳</span>
                    <span class="status-text" id="statusText">准备中...</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    <span class="progress-text" id="progressText">0/0</span>
                </div>
            </div>

            <!-- 当前步骤信息 -->
            <div class="current-step" id="currentStep" style="display: none;">
                <div class="step-info">
                    <h4 class="step-name" id="stepName"></h4>
                    <p class="step-description" id="stepDescription"></p>
                </div>
            </div>

            <!-- 🔑 人机验证等待界面 (核心新功能) -->
            <div class="human-verification" id="humanVerification" style="display: none;">
                <div class="verification-header">
                    <span class="verification-icon">🔐</span>
                    <h3>需要人机验证</h3>
                </div>
                <div class="verification-content">
                    <p class="verification-message" id="verificationMessage">
                        请在页面上完成人机验证，然后点击下方的"继续"按钮
                    </p>
                    <div class="verification-timeout" id="verificationTimeout">
                        <span>剩余时间: </span>
                        <span class="timeout-counter" id="timeoutCounter">5:00</span>
                    </div>
                </div>
                <div class="verification-actions">
                    <button id="continueBtn" class="primary-btn">✅ 继续执行</button>
                    <button id="skipVerificationBtn" class="secondary-btn" style="display: none;">跳过</button>
                    <button id="retryVerificationBtn" class="secondary-btn" style="display: none;">重试</button>
                </div>
            </div>

            <!-- 控制按钮 -->
            <div class="button-group">
                <button id="startAutomationBtn" class="primary-btn">开始自动化注册</button>
                <button id="pauseAutomationBtn" class="secondary-btn" style="display: none;">⏸️ 暂停</button>
                <button id="resumeAutomationBtn" class="secondary-btn" style="display: none;">▶️ 恢复</button>
                <button id="stopAutomationBtn" class="danger-btn" style="display: none;">⏹️ 停止</button>
                <button id="openSidebarBtn" class="secondary-btn">📋 侧边栏</button>
                <button id="manageFlowsBtn" class="secondary-btn">⚙️ 管理流程</button>
            </div>

            <!-- 步骤进度列表 -->
            <div class="automation-progress" id="automationProgress" style="display: none;">
                <h4>执行进度</h4>
                <div id="automationSteps" class="steps-container">
                    <!-- 动态生成步骤进度 -->
                </div>
            </div>

            <!-- 执行日志 -->
            <div class="execution-log" id="executionLog" style="display: none;">
                <h4>执行日志</h4>
                <div class="log-container" id="logContainer">
                    <!-- 显示执行日志 -->
                </div>
                <div class="log-actions">
                    <button id="clearLogBtn" class="secondary-btn">清除日志</button>
                    <button id="exportLogBtn" class="secondary-btn">导出日志</button>
                </div>
            </div>
        </section>
    </div>

    <!-- 历史记录弹窗 -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="historyModalTitle" class="modal-title">历史记录</h3>
                <button id="closeHistoryModal" class="close-btn">✕</button>
            </div>
            <div class="modal-body">
                <!-- 搜索框 -->
                <div class="search-container" id="searchContainer" style="display: none;">
                    <input type="text" id="searchInput" class="search-input" placeholder="搜索邮箱...">
                </div>
                
                <!-- 历史列表 -->
                <div id="historyList" class="history-list">
                    <!-- 动态生成历史记录项 -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="clearHistoryBtn" class="danger-btn">清除全部</button>
                <button id="exportHistoryBtn" class="secondary-btn">导出历史</button>
            </div>
        </div>
    </div>



    <!-- 加载遮罩 -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text">处理中...</div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="notification" style="display: none;">
        <span id="notificationText"></span>
    </div>

    <script src="popup.js"></script>
</body>
</html>
